# ğŸ“ŒíšŒì› ê´€ë¦¬ ì˜ˆì œ-ë°±ì—”ë“œ ê°œë°œ

## 1. ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬ì¡°

- ì»¨íŠ¸ë¡¤ëŸ¬: ì›¹ MVCì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• 
- ì„œë¹„ìŠ¤: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ (íšŒì› ì¤‘ë³µ ê°€ì… ë°©ì§€ ê¸°ëŠ¥)
- ë¦¬í¬ì§€í† ë¦¬: ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
- ë„ë©”ì¸: ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´, ì˜ˆ) íšŒì›, ì£¼ë¬¸, ì¿ í° ë“±ë“± ì£¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ê´€ë¦¬ë¨

## 2. íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

hello.hellospring/domain/Member - íšŒì› ë„ë©”ì¸

hello.hellospring/repository - íšŒì› ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ì €ì¥ì†Œ

```java
@Override
    public Member save(Member member) {
        member.setId(++sequence); //Sequence : 0,1,2ë“± í‚¤ê°’ì„ ìƒì„±
        store.put(member.getId(), member);
        return member;
    }
```

### Optional<>

```java
@Override
public Optional<Member> findById(Long id) {
        return Optional.ofNullable(store.get(id));
    }
```

findByIdë¥¼ í†µí•´ Idë¥¼ ì°¾ì„ ë•Œ, idê°€ ì—†ì„ ê²½ìš° nullì„ returní•˜ê²Œ ëœë‹¤.

ì´ë•Œ Optional<>ì„ ì´ìš©í•´ ê°ì‹¸ `store.get(id)`ì´ nullì´ì–´ë„ í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤.

Optional<>ì—ì„œ ê°’ì„ êº¼ë‚¼ ë•ŒëŠ” `.get()`ì„ ì¶”ê°€í•´ì¤€ë‹¤

```java
@Override
    public Optional<Member> findByName(String name) {
        store.values().setream()
                .filter(member->member.getName().equals(name))
    }
```

ë£¨í”„ë¥¼ ëŒë ¤, member.getName()ì´ íŒŒë¼ë¯¸í„°ë¡œ ê°€ì ¸ì˜¨ nameê³¼ ê°™ì„ ê²½ìš°ì—ë§Œ filteringë˜ë„ë¡ í•œë‹¤. 

ë§Œì•½ ìˆì„ ê²½ìš° ê·¸ëŒ€ë¡œ return, ì—†ì„ ê²½ìš° Optionalì— nullì´ í¬í•¨ë˜ì–´ return

## íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±

ì‘ì„±í•œ ì½”ë“œê°€ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ test ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.

test caseì˜ íŒ¨í‚¤ì§€ ì´ë¦„ì€ mainê³¼ ê°™ê²Œ ì„¤ì •í•œë‹¤

í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ í´ë˜ìŠ¤ì˜ ì´ë¦„ ë’¤ì— Testë¥¼ ë¶™ì¸ë‹¤
(`MemoryMemberRepository` â†’ `MemoryMemberRepositoryTest`)

### Test-save()

@test ì•„ë˜ì˜ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```java
//MemoryMemberRepositoryTest
@Test
    public void save(){
        Member member=new Member();
        member.setName("spring");

        repository.save(member);

        Member result = repository.findById(member.getId()).get();
        org.assertj.core.api.Assertions.assertThat(member).isEqualTo(result);
				//Assertions.assertEquals(member, result);//(expected, actual)
    }
```

saveí•¨ìˆ˜ë¥¼ testí•œë‹¤

1. setName(â€springâ€)ì„ í†µí•´ ì´ë¦„ ì„¤ì • í›„, `repository.save(member);`ë¥¼ í†µí•´ idë¥¼ í• ë‹¹í•œë‹¤
2. `Member result = repository.findById(member.getId()).get();`ë¥¼ í†µí•´ Optionalì— ì‹¸ì—¬ì§„ ê°’ì„ resultë¡œ ê°€ì ¸ì˜¨ë‹¤. 
* Optionalì´ ì‚¬ìš©ë˜ì—ˆë‹¤ë©´ .get()ìœ¼ë¡œ ê°€ì ¸ì™€ì•¼ í•œë‹¤.
3. `Assertions.assertEquals(member, result);`ë¡œ memberê³¼ resultë¥¼ ë¹„êµí•œë‹¤. ê°™ë‹¤ë©´ Runì´ ì„±ê³µ, ë‹¤ë¥´ë‹¤ë©´ ì‹¤íŒ¨í•œë‹¤
4. ìš”ì¦˜ì€ 3ë²ˆë³´ë‹¤ `org.assertj.core.api.Assertions.assertThat(member).isEqualTo(result);`ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤. (alt + enterë¡œ ì¤„ì´ê¸° ê°€ëŠ¥)

### Test-findByName()

```java
@Test
    public void findByName(){//ì´ë¦„ìœ¼ë¡œ ì°¾ê¸°
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1); //spring1 íšŒì› ê°€ì…

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2); //spring2 íšŒì› ê°€ì…

        Member result = repository.findByName("spring1").get();

        assertThat(result).isEqualTo(member1);
    }
```

Testì—ì„œ findByNameì„ í…ŒìŠ¤íŠ¸ í•˜ê¸° ìœ„í•´  findByName()í•¨ìˆ˜ ì•ˆì— spring1, spring2ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ íšŒì›ì„ ìƒì„± í›„ `findByName("spring1")`ì„ ì‹¤í–‰ì‹œì¼œ spring1ì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ íšŒì›ì„ ì°¾ì•„ member1ê³¼ ê°™ì€ì§€ í™•ì¸í•œë‹¤.

### Test-findAll()

```java
@Test
    public void findAll() {
        //given
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        //when
        List<Member> result = repository.findAll();
        //then
        assertThat(result.size()).isEqualTo(2);
    }
```

`assertThat(result.size()).isEqualTo(2);`ë¥¼ í†µí•´ memberì˜ ì´ ì¸ì›ì´ 2ëª…ì¸ì§€ í™•ì¸, ë§ì„ê²½ìš° Runì´ ì‹¤í–‰ë˜ë©° ë‹¤ë¥´ë‹¤ë©´ ì‹¤íŒ¨í•œë‹¤.

### Test ì£¼ì˜ì‚¬í•­-@AfterEach

ëª¨ë“  ìˆœì„œëŠ” ë³´ì¥ë˜ì§€ ì•Šìœ¼ë©°, ìˆœì„œì™€ ìƒê´€ì—†ì´ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„ë¥¼ í•´ì•¼í•œë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ 

```java
Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);
```

ê°€ ë‘ë²ˆ ì´ìƒ ì‹¤í–‰ë  ê²½ìš° ì´ë¯¸ ë©¤ë²„ê°€ ì €ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ê°€ ì¶œë ¥ë˜ê²Œ ëœë‹¤.

ë”°ë¼ì„œ í•˜ë‚˜ì˜ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ í›„ ë°ì´í„°ë¥¼ clearí•´ì£¼ì–´ì•¼ í•œë‹¤.

```java
//MemoryMemberRepository
public void clearStore() {
        store.clear();
    }

//MemoryMemberRepositoryTest
@AfterEach
    public void afterEach() {
        repository.clearStore();
    }
```

mainì˜ `MemoryMemberRepository`ì— clearStoreí•¨ìˆ˜ë¥¼ ì‘ì„±í›„, Testì— @AfterEachë¥¼ í†µí•´ ë§¤ Testê°€ ëë‚ ë•Œë§ˆë‹¤ ì‹¤í–‰í•˜ë„ë¡ í•´ì£¼ë©´ ì˜¤ë¥˜ ì—†ì´ ë™ì‘í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ - testë¥¼ ë¨¼ì € ë§Œë“  ë’¤, í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ êµ¬í˜„

## íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

í…ŒìŠ¤íŠ¸ ì¶”ì²œ ë¬¸ë²•

```java
//given, ë¬´ì–¸ê°€ê°€ ì£¼ì–´ì¡Œì„ ë•Œ 

//when, ì´ê²ƒì„ ì‹¤í–‰í•´ì„œ 

//then, ì´ëŸ¬í•œ ê²°ê³¼ê°€ ë‚˜ì˜¬ ê²ƒì´ë‹¤
```

*`assertThrows*(IllegalStateException.class, ()->memberService.join(member2));` 
:ê°™ì€ í´ë˜ìŠ¤ì¸ì§€ ê²€ì¦í•˜ëŠ” ë°©ë²•

ì²« ë²ˆì§¸ ì¸ì : ë°œìƒí•  ì˜ˆì™¸ í´ë˜ìŠ¤ì˜ classíƒ€ì…, ì˜ˆì™¸ ë°œìƒì‹œ ê°™ì€ classtypeì¸ì§€ ì²´í¬

()â†’memberService.join(member2)); = ì´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ ì˜ˆì™¸ê°€ ë°œìƒë¨.

*`assertThat*(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");` 
:ì¶œë ¥ë˜ëŠ” ë©”ì„¸ì§€ê°€ ê°™ì€ì§€ ê²€ì¦

### @BeforeEach

`@BeforeEach :` í…ŒìŠ¤íŠ¸ê°€ ë™ì‘í•˜ê¸° ì „ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ë„£ì–´ì¤€ë‹¤.